\documentclass{article}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{animate}
\title{%
Laboratory 4\\
  \huge Simulated Annealing in Binary Images}
\author{Filip Zieli≈Ñski}
\date{03/04/2024 r.}

\begin{document}
\maketitle


\section*{Problem Description}
A binary image is an two dimensional array consisting of only two values.
\\
Consider a binary image of a given size.  Let \textit{Energy} : $ (x,y) \rightarrow \mathbb{R}_+ $ be a function that evalates an energy of a single cell.
\\
We define Energy of state to be sum of energy of every cell. Our goal is to minimize the binary image energy without changing the cardinality of zero's and one's in it.
\\
We usually evaluate energy in context of defined \textit{Neibourghood} of a cell. Standard Neighbourhoods examples:
\begin{itemize}
    \item 4-Neibourghood (up, down, left, right), 
    \item 8-Neibourghood (4-Neibourghood + diagonals),
    \item Diagonal-Neibourghood (only diagonals),
    \item 15-Neibourghood (4x4 square around a cell).
\end{itemize}
Energy can be defined regardless of Neibourghood, but usually combining those two concept gives the most interesting results.
\section*{Simualted Annealing}
Simulated Annealing is an iterative metaheuristic for finding the function extremum. In this case we start with a randomly generated binary image of
given size and by swapping random elements we try to localize the energy function minimum. 
\\
Crucial aspect of simulated annealing is a fact, that if we find a state that lower cost function, we always accept it, but sometimes we also accept 
worse state (especially at begining of a simulation). This technique increases probability of finding  global minimum, not local one.
\\
The Algorithm works as follows:

\begin{enumerate}
    \item Initialize the binary image randomly.
    \item Calculate the energy of the initial state.
    \item Repeat for given number of iterations:
    \begin{enumerate}
        \item Generate a neighboring solution by making a small random change to the current solution.
        \item Calculate the energy of the new state.
        \item If the new state has lower energy, accept it as the current state.
        \item If the new state has higher energy, accept it with a probability based on the energy difference and a cooling schedule.
    \end{enumerate}
\end{enumerate}

\section*{Energy Functions}
Energy functions that I have used and tested are:
\begin{enumerate}
    \item \textit{Normal Energy} - the Energy increases by one for every neighbour of the same type.
    \item \textit{Unity Energy} - the Energy increases by one for every neighbour of diferent type. 
    \item \textit{Difference Energy} - the Energy of a cell is absolute value of difference of numbers of  black and white neighbours. 
    \item \textit{Center Energy} - white cells lose energy  on a verge of an image, black cells lose energy in the center of an image, but there's also a factor of normal energy, meaning cell increases energy if it is only surrounded by it's type.
    \item \textit{Parabola Energy} - cell loses energy when it has nearly 0 neighbours of it's type or nearly all of it's neighbours are it's type. 
\end{enumerate}

\section*{Code and Implementation}
Entry Parameteres related to simulation:
\begin{enumerate}
    \item Neibourghood type 
    \item Energy type 
    \item Size of an image 
    \item Percentage of black cells 
    \item Number of iterations
    \item Initial temperature
    \item Coefficient for multiplying temperature
\end{enumerate}
Result:
\begin{enumerate}
    \item Image of starting position
    \item Image of final result 
    \item Annealing process plot 
    \item Gif of the simulation
\end{enumerate}

I encourage you too see full Implementation  here:  
\\
All examples were generated by this code. 

\section*{Examples of Results}
\subsection*{Example 1}
Parameteres:
\begin{enumerate}
    \item 15-Neibourghood.
    \item Unity Energy
    \item 30\% black cells
    \item Image size - 50x50
    \item 50 000 iterations
    \item Initial temperature - 200
    \item Alpha coefficient - 0.999
\end{enumerate}
First iteration vs Final result:
\\\\
\includegraphics*[width = 0.4\linewidth ]{output/first/first_iter.png}
\includegraphics*[width = 0.4\linewidth ]{output/first/final_result.png}
\\\\
Annealing plot:
\\
\includegraphics*[width = 0.8\linewidth ]{output/first/annealing_plot.png}
\\
Simulation gif can be found as gifs/example1.gif. 

\subsection*{Example 2}
Parameteres:
\begin{enumerate}
    \item 15-Neibourghood.
    \item Center Energy
    \item 40\% black cells
    \item Image size - 512x512
    \item 200 000 iterations
    \item Initial temperature - 1000
    \item Alpha coefficient - 0.9999
\end{enumerate}
First iteration vs Final result:
\\\\
\includegraphics*[width = 0.4\linewidth ]{output/third/first_iter.png}
\includegraphics*[width = 0.4\linewidth ]{output/third/final_result.png}
\\\\
Annealing plot:
\\
\includegraphics*[width = 0.8\linewidth ]{output/third/annealing_plot.png}
\\
Simulation gif can be found as gifs/example2.gif. 

\subsection*{Example 3}
Parameteres:
\begin{enumerate}
    \item Diagonal-Neibourghood.
    \item Unity Energy
    \item 40\% black cells
    \item Image size - 128x128
    \item 20 000 iterations
    \item Initial temperature - 50
    \item Alpha coefficient - 0.9994
\end{enumerate}
First iteration vs Final result:
\\\\
\includegraphics*[width = 0.4\linewidth ]{output/fourth/first_iter.png}
\includegraphics*[width = 0.4\linewidth ]{output/fourth/final_result.png}
\\\\
Annealing plot:
\\
\includegraphics*[width = 0.8\linewidth ]{output/fourth/annealing_plot.png}
\\
Simulation gif can be found as gifs/example3.gif. 
\subsection*{Example 4}
Parameteres:
\begin{enumerate}
    \item 15-Neibourghood.
    \item Difference Energy
    \item 40\% black cells
    \item Image size - 128x128
    \item 20 000 iterations
    \item Initial temperature - 10
    \item Alpha coefficient - 0.99
\end{enumerate}
First iteration vs Final result:
\\\\
\includegraphics*[width = 0.4\linewidth ]{output/fifth/first_iter.png}
\includegraphics*[width = 0.4\linewidth ]{output/fifth/final_result.png}
\\\\
Annealing plot:
\\
\includegraphics*[width = 0.8\linewidth ]{output/fifth/annealing_plot.png}
\\
Simulation gif can be found as gifs/example4.gif. 

\subsection*{Example 5}
Parameteres:
\begin{enumerate}
    \item 15-Neibourghood.
    \item Parabola Energy
    \item 60\% black cells
    \item Image size - 256x256
    \item 50 000 iterations
    \item Initial temperature - 1000
    \item Alpha coefficient - 0.9999
\end{enumerate}
First iteration vs Final result:
\\\\
\includegraphics*[width = 0.4\linewidth ]{output/sixth/first_iter.png}
\includegraphics*[width = 0.4\linewidth ]{output/sixth/final_result.png}
\\\\
Annealing plot:
\\
\includegraphics*[width = 0.8\linewidth ]{output/sixth/annealing_plot.png}
\\
Simulation gif can be found as gifs/example5.gif. 

\subsection*{Example 5}
Parameteres:
\begin{enumerate}
    \item 15-Neibourghood.
    \item Parabola Energy
    \item 40\% black cells
    \item Image size - 512x512
    \item 100 000 iterations
    \item Initial temperature - 500
    \item Alpha coefficient - 0.9997
\end{enumerate}
First iteration vs Final result:
\\\\
\includegraphics*[width = 0.4\linewidth ]{output/seventh/first_iter.png}
\includegraphics*[width = 0.4\linewidth ]{output/seventh/final_result.png}
\\\\
Annealing plot:
\\
\includegraphics*[width = 0.8\linewidth ]{output/seventh/annealing_plot.png}
\\
Simulation gif can be found as gifs/example6.gif. 


\end{document}